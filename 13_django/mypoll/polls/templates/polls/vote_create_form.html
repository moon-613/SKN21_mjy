{% extends "layout/main_layout.html" %}

{% block title %}질문 등록 - form.py{% endblock title %}
{% block contents %}

<h1>설문 문제 등록 - forms.py 이용</h1>

<form method="post">
    {% csrf_token %}

    {{q_form}}
    <h3 class="mt-2">보기</h3>

    {{c_formset.management_form}}
    {% comment %}
        <input type="hidden" name="form_TOTAL_FORMS" value="2" id="id_FORM-TOTAL_FORMS">
        <input type="hidden" name="form_TOTAL_FORMS" value="2" id="id_FORM-TOTAL_FORMS">
        <input type="hidden" name="form_TOTAL_FORMS" value="2" id="id_FORM-TOTAL_FORMS">
        <input type="hidden" name="form_TOTAL_FORMS" value="2" id="id_FORM-TOTAL_FORMS">
        formset 객체의 정보
        이 정보들을 view에 전달해야 정상적으로 처리가 가능.
        TOTAL_FORMS: formset으로 생성한 input의 개수. view에서는 이 개수만큼만 읽어서 처리
                    그래서 동적으로 input을 생성/삭제할 경우 TOTAL_ 
    {% endcomment %}
    <div id="choice_layer">
        {% for c_form in c_formset %}
            {{c_form}}
        {% endfor %}
    </div>

    <div id="btn_layer">
            <button type="button" onclick="addChoice();">보기 추가</button>
            <button type="button" onclick="delChoice();">보기 삭제</button>
            <button type="submit" class="btn btn-success">문제 등록</button>
    </div>
</form>
{% endblock contents %}
{% block javascript %}
<script>
    function addChoice() {
        // "input[name$='choice_text']"input 태그. name 속성의 값이 choice_text로 끝나는 것.
        //"input[name$= $:끝나는 것. ^:시작하는 것.
        const choice_text_cnt = document.querySelectorAll("input[name$='choice_text']").length;
        const choice_input_name = `form-${choice_text_cnt-choice_text`;
        
        const choice_input = document.createElement("input");
        choice_input.setAttribute("type", "text");
        choice_input.setAttribute("name", choice_input_name);
        choice_input.setAttribute("required", true);
        choice_input.setAttribute('class', "form-control");

        const layer = document.getElementById("choice_layer");
        layer.appendChild(choice_input);

        // formset으로 생성한 TOTAL_FORMS (폼 개수)값을 1 증가.
        const totalForms = document.getElementById("id_form-TOTAL_FORMS");
        totalForms.value = parseInt(totalForms.value) + 1; 
    }
        function delChoice() {
        const layer = document.querySelector('#choice_layer');
        if (layer.children.length > 2){
        // 삭제
        layer.removeChild(layer.lastChild);
        } else {
         //유지
        alert("보기가 두 개면 삭제가 안됩니다.");
        // TOTAL_FORMS의 value를 -1
        
        
        }}

</script>
{% endblock javascript %}